
ruby script to export ibooks highlights from ibooks databases

Highlights and notes are in the below file
Documents/storeFiles/AEAnnotation_v..._local.sqlite

In the ZAEANNOTATION TABLE

The Note is in the ZANNOTATIONOTE field
The Highlight is in the ZANNOTATIONSELECTEDTEXT field
The book id is in the ZANNOTATIONASSETID field

The book to ZANNOTATIONASSETID map is in the
Documents/BKLibrary_database/iBooks_v....sqlite file

In the ZBKBOOKINFO table

The book id is in the ZBOOKUNIQUEID field
The book title is in the ZBOOKTITLE field
If the book has DRM then the book id is in the ZDATABASEKEY field
ZDATABASEKEY and ZBOOKUNIQUEID are equal in all cases when the book is not DRMed. So ignore ZBOOKUNIQUEID and only use ZDATABASEKEY.
The ZANNOTIONTYPE is to make sure it is a highlight or a note. This way you can avoid reading list book marks and the like. 
The ZPLLOCATIONRANGESTART field may the location of the note/highlight. this is to help sort the order of notes
The ZANNOTATIONDELETED field is to indicate if the note/highlight was delected or note. a value of 1 means it was deleted. The script will not collect deleted highlights or notes

The script executes on these two dbs to export your notes and highlights.

The '...' are a seamingly random series of numbers. You need to get these files out of our iOS device by using iphone/ios backup extractors.

Usage
The ruby script takes two (and only two) arguments. They are the path/fileNames of the sqlite database files need to extract info from. Notes for each book will be their own file and output to the bookNotes directory.

